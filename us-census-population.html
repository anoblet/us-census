<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="us-census-population">
  <template>
    <style>
      :host {
      }
    </style>
    <iron-ajax id="ajax" url="[[_baseUrl]]" on-response="_handleResponse"></iron-ajax>
  </template>
  <script>
      class UsCensusPopulation extends Polymer.Element {
          static get is() {
              return 'us-census-population';
          }

          static get properties() {
              return {
                  _baseUrl: {
                      type: String,
                      value: "https://api.census.gov/data/2016/pep/population"
                  },
                  data: {
                      type: String,
                      notify: true
                  },
                  fields: {
                      type: Array,
                      value: function () {
                          return [
                              // "GEONAME",
                              "POP"
                          ]
                      }
                  },
                  state: {
                      type: Object,
                      notify: true
                  }
              }
          }

          static get observers() {
              return [
                  "_stateChanged(state.code)"
              ]
          }

          _getParams() {
              let fields = this.fields.join(", ");
              console.log(fields);
              return {
                  "get": fields,
                  "for": "state:" + this.state.code,
                  // "key": this.apiKey
              }
          }

          _handleResponse(e) {
              let response = e.detail.response;
              let population = response[1][0];
              // Format the number
              population = population.toLocaleString();
              this.set('state.population', population);
          }

          _stateChanged() {
              console.log("State changed");
              console.log(this.state);
              let ajax = this.shadowRoot.querySelector("iron-ajax");
              ajax.params = this._getParams();
              ajax.generateRequest();
          }
      }

      window.customElements.define(UsCensusPopulation.is, UsCensusPopulation);
  </script>
</dom-module>
